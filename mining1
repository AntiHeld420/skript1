local whitelist = {
  ["minecraft:coal_ore"] = true,
  ["minecraft:iron_ore"] = true,
  ["minecraft:gold_ore"] = true,
  ["minecraft:diamond_ore"] = true,
  ["minecraft:emerald_ore"] = true,
  ["minecraft:redstone_ore"] = true,
  ["minecraft:copper_ore"] = true,
  ["minecraft:lapis_ore"] = true,
  ["minecraft:deepslate_coal_ore"] = true,
  ["minecraft:deepslate_iron_ore"] = true,
  ["minecraft:deepslate_gold_ore"] = true,
  ["minecraft:deepslate_diamond_ore"] = true,
  ["minecraft:deepslate_emerald_ore"] = true,
  ["minecraft:deepslate_redstone_ore"] = true,
  ["minecraft:deepslate_copper_ore"] = true,
  ["minecraft:deepslate_lapis_ore"] = true,
}

-- Refuel if fuel level below threshold
function refuel()
  if turtle.getFuelLevel() < 100 then
    for slot = 1, 16 do
      turtle.select(slot)
      if turtle.refuel(0) then
        turtle.refuel(1)
        break
      end
    end
  end
end

-- Dig down until Y=6 (using gps)
function digDownToY6()
  local _, y = gps.locate()
  while y and y > 6 do
    refuel()
    if turtle.detectDown() then
      turtle.digDown()
    end
    turtle.down()
    _, y = gps.locate()
  end
end

-- Try to dig in the given direction if block is in whitelist
function tryDig(direction)
  local success, data
  if direction == "front" then
    success, data = turtle.inspect()
  elseif direction == "up" then
    success, data = turtle.inspectUp()
  elseif direction == "down" then
    success, data = turtle.inspectDown()
  end

  if success and data and whitelist[data.name] then
    if direction == "front" then
      turtle.dig()
    elseif direction == "up" then
      turtle.digUp()
    elseif direction == "down" then
      turtle.digDown()
    end
  end
end

-- Dig and scan forward (front, up, down), then move forward
function digAndScanForward()
  refuel()
  tryDig("front")
  tryDig("up")
  tryDig("down")
  turtle.forward()
end

-- Create a 3x3 tunnel 30 blocks long
function tunnel3x3x30()
  for i = 1, 30 do
    digAndScanForward()
    turtle.turnLeft()
    tryDig("front")
    turtle.turnRight()
    turtle.turnRight()
    tryDig("front")
    turtle.turnLeft()
  end
end

-- Strip mine multiple passages with given count and spacing
function stripMinePassages(count, spacing)
  for i = 1, count do
    turtle.turnRight()
    for j = 1, 200 do
      digAndScanForward()
    end
    for j = 1, 200 do
      turtle.back()
    end
    turtle.turnLeft()
    for s = 1, spacing do
      turtle.forward()
    end
  end
end

-- Return to start and empty inventory
function returnAndEmpty()
  for i = 1, 30 do
    turtle.back()
  end
  for slot = 1, 16 do
    turtle.select(slot)
    turtle.drop()
  end
end

-- Main program execution
refuel()
digDownToY6()
tunnel3x3x30()
stripMinePassages(5, 5)
returnAndEmpty()
